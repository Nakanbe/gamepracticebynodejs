<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <title>chk</title>
</head>
<body onload="do_first();">
  <div>
    <table border=1 style="text-align:center;" id="show">
      <thead>
        <tr>
          <td>站台</td>
          <td>球種下拉式選單</td>
          <td>開賽時間（start_dt+start_time）</td>
          <td>內容（聯盟中文名稱<br>主隊中文名稱 VS 客隊中文名稱</td>
          <td>比分（主 VS 客）</td>
          <td>功能</td>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>
</body>
</html>

<script>
  
  const webid_arr = {
    '1': 'sportslottery',
    '2': 'jingcai',
    '3': '7sport',
    '4': '8betsport',
    '5': 'foot-bet-9',
    '6': 'foot-bet-10',
    '7': 'bedminton-11',
    '8': 'bedminton-12'
  }
  
  const gtype = {
    "BS":"美棒",
    "BK":"籃球",
    "FT":"足球",
    "CB":"中華職棒",
    "KB":"其他棒球",
    "JB":"日棒",
    "AF":"美足",
    "IB":"冰球",
    "LO":"彩球",
    "ST":"指數",
    "WB":"其他籃球",
    "EB":"電競",
    "EK":"國際籃球",
    "EF":"國際足球",
    "TN":"網球",
    "VB":"排球",
    "PO":"板球",
    "HB":"手球",
    "BM":"羽毛球",
    "BL":"撞球",
    "GD":"賽馬/賽狗"
  }
  var webid_sel;
  var sport_sel;
  //第一次進入網站 
  function do_first(){
    webid_sel = select_create(webid_arr, 'web');  //產生下拉式選單
    sport_sel = select_create(gtype, 'sport');    //產生下拉式選單
    $('#show tbody').append('<tr><td>'+webid_sel+'</td><td>'+sport_sel+'</td></tr>');  
    getData();
  }
  //第一次進入網站 <td></td><td></td><td></td><td></td>
  
  //當下拉式選單有改變時，會觸發這個函式
  function getData(){
    var webid = document.getElementById("web").value;
    var gametype = document.getElementById("sport").value;
    $.ajax({
      type: 'POST',
      url: 'db.php',
      data: {
        webid: webid,
        gametype: gametype
      },
      datatype: 'JSON',
      success: function(data){
        output(data);
      }
    });
  }
  
  //按下刪除按鈕會觸發此函式
  function del(gameid, i){
    <!-- i.remove(); -->
    <!-- console.log($('tbody tr').siblings()); -->
    //若是第一列被刪除，就要再把select加回來
    //if($('tbody tr').siblings().length == 0) //沒有一樣的element (<tr>)
    <!-- if(i.innerHTML == $('tr').eq(1)[0].innerHTML){ -->
      <!-- var tempx = $('td').eq(6); -->
      <!-- var tempy = $('td').eq(7); -->
      <!-- i.remove(); -->
      <!-- $(tempx).insertBefore($('td').eq(6)); -->
      <!-- $(tempy).insertBefore($('td').eq(7)); -->
    <!-- } -->
    <!-- else{ -->
      <!-- i.remove(); -->
    <!-- } -->
    i.remove();
    $.ajax({
      type: 'POST',
      url: 'db.php',
      data: {
        gameid: gameid
      },
      datatype: 'JSON'
    });
  }
  
  //產生下拉式選單
  function select_create(arr, id){
    var str = '<select id="'+id+'" onchange="getData()">';
    for(var key in arr){  //option用loop印出來
      str += '<option value="'+key+'"> ' + arr[key] + ' </option>';
    }
    str += '</select>';
    return str;
  }
  
  //0,1,2 ,3 ,4 ,5
  //6,7,8 ,9 ,10,11
  //   ,12,13,14,15
  
  //0,1,2,3,4,5
  //0,1,2,3,4,5
  //    0,1,2,3
  
  //0,1,2 ,3 ,4 ,5
  //   ,6 ,7 ,8 ,9
  //   ,10,11,12,13
  //先刪除多出來的row，再把內容替換掉，最後row數不夠再加上去
  function output(data){
    document.getElementsByTagName('td')[6].setAttribute('rowspan',data.length+1);  //設定webid select那格的rowspan
    document.getElementsByTagName('td')[7].setAttribute('rowspan',data.length+1);  //設定sport select那格的rowspan
    var tbody_row = document.getElementById('show').tBodies[0].rows.length-1;  //舊的table的row數,-1是因為select佔一個row數量
    
    //把多出來的row刪掉
    if(tbody_row > data.length){  
      for(var i = tbody_row; i > data.length; i--){
        document.getElementById('show').tBodies[0].deleteRow(i-1);
      }
      tbody_row = document.getElementById('show').tBodies[0].rows.length-1;  //新的table的row數,-1是因為select佔一個row數量
    }
    
    //更新row裡的資料
    if(data[0] == "NO DATA"){
      <!-- for(var i = 5; i > 1; i--){ -->
        <!-- $('tbody td')[i].remove(); -->
      <!-- } -->
      for(var i = 2; i < 6; i++){
        $('tbody td').innerHTML = '';
      }
    }
    else{  //替換table裡的資料
      for(var k = 2, i = 0; i < tbody_row; k+=4, i++){
        $('tbody td')[k].innerHTML = data[i]['date_time'];
        $('tbody td')[k+1].innerHTML = data[i]['league_name'] + '<br>' + data[i]['home_name'] + '[主] VS ' + data[i]['cust_name'];
        $('tbody td')[k+2].innerHTML = data[i]['home_s'] + ':' + data[i]['cust_s'];
        $('tbody td')[k+3].innerHTML = '<input type="button" value="刪除" onclick="del('+ data[i]['game_id']+ ',event.path[2]' +')">';  //event.path[2] => tr
      }
    }
    
    //印新的row出來
    var str = '';
    for(var i = tbody_row; i < data.length; i++){
      str = '';
      str += '<td>' + data[i]['date_time'] + '</td>';  
      str += '<td>' + data[i]['league_name'] + '<br>' + data[i]['home_name'] + '[主] VS ' + data[i]['cust_name'] + '</td>';
      str += '<td>' + data[i]['home_s'] + ':' + data[i]['cust_s'] + '</td>';
      str += '<td><input type="button" value="刪除" onclick="del('+ data[i]['game_id']+',event.path[2]'+')"></td>';  //del 裡放的是這個比賽的game_id 
      $('#show tbody').append('<tr>'+str+'</tr>');
    }
  }
  
  //10秒自動更新
  setInterval(getData, 10000);
  
</script>